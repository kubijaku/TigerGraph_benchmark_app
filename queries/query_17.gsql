BEGIN
CREATE OR REPLACE DISTRIBUTED QUERY query_17(VERTEX<Entity> startNode, INT depth) FOR GRAPH ADS { 
  /* 0 = Synonym, 1 = Antonym */
  MinAccum<INT> @polarity = -1; 
  OrAccum @visited = false;
  
  Start = {startNode};
  Start = SELECT s FROM Start:s 
          ACCUM s.@polarity = 0, s.@visited = true;

  FOREACH i IN RANGE[1, depth] DO
    Start = SELECT t FROM Start:s -(Relation:e)-> Entity:t
            WHERE (e.id == "/r/Synonym" OR e.id == "/r/Antonym")
            AND t.@visited == false
            ACCUM 
              INT edgeVal = 0,
              IF e.id == "/r/Antonym" THEN edgeVal = 1 END,
              /* XOR here */
              t.@polarity = (s.@polarity + edgeVal) % 2, 
              t.@visited = true;
  END;

  Result = SELECT s FROM Start:s WHERE s.@polarity == 0;
  
  PRINT Result;
}
USE GRAPH ADS
INSTALL QUERY query_17
END